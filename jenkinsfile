pipeline {
    agent any

    stages {
        stage('Test Login') {
            steps {
                script {
                    // Wyświetl zawartość katalogu roboczego
                    sh 'ls -l'
                    // Uruchomienie testu logowania
                    sh 'pytest -m login tests/test_login.py'
                    // Stash state file for later use
                    stash includes: 'state_login.json', name: 'state_login'
                }
            }
        }
        stage('Other Tests') {
            steps {
                script {
                    // Unstash state file for use in other tests
                    unstash 'state_login'
                    // Sprawdź, czy plik został poprawnie unstashed
                    sh 'ls -l'
                    sh 'cat state_login.json'
                    // Uruchomienie innych testów
                    sh 'pytest tests/'
                }
            }
        }
    }
    post {
        always {
            // Archiwizowanie pliku z kontekstem na potrzeby inspekcji po zakończeniu pipeline
            archiveArtifacts artifacts: 'state_login.json', allowEmptyArchive: true
        }
    }
}
